# 14.通过共通设计提高一致性（2）

###### 1.关于“报表通用”设置

与屏幕相比，设计师可能较少，因此在某些情况下可能不需要这样的设置。但与屏幕一样，为报表设置通用规则可以减少混乱。

###### 分页处理 

如果是在单页上完成的单一报表，则没有问题。但许多表格样式的报表可能会跨多个页面。在这种情况下，如果需要在数据中途进行分页，您应该制定如何进行分页的规则。

###### i）数据处理方式 

当数据跨越多行并可能导致分页时，需要决定是否在数据中途进行分页，还是将整个数据移至下一页的规则。

###### ii）分页时的标题 

对于跨多页的报表，应该制定在随后的页面上是否打印标题的规则。



###### 2.数据溢出 

当目标项目的打印区域（类似于Excel的单元格）相对于数据变小时，数据会溢出。在打印固定长度的数据时不太容易发生，但在数据类型为TEXT或通过组合和计算生成数据时会发生。在这种情况下，需要决定如何显示数据。可以选择以下方法之一或多个（例如调整字体大小、自动换行或省略）并在报表设计中按策略名称进行描述。

1. **字体大小的调整** 

   这是通过改变字体大小来确保数据完全打印在打印区域的策略。根据打印区域的大小和数据的大小计算字体大小，并动态地调整字体大小进行打印。

2. **自动换行** 

   这是一种策略，即不更改字体大小，但当数据到达打印区域的宽度时，会进行换行以打印所有数据。如果由于换行而需要进行分页，则按照分页策略进行。

3. **省略** 

   这是一个策略，只打印能够放入打印区域的数据。可以简单地省略显示区域之外的部分、使用摘要进行省略（实际处理可能会很复杂）或为溢出数据准备特定数据，并在数据不适合时使用该数据。



###### 3.页面数控制 

根据指定的打印数据量，页面数会相应确定。虽然会根据数据量来设计报表，但考虑到报表的数量，可能在预期的时间内无法完成打印（实际上，在打印时，需要考虑到与普通的打印输出相比，可能需要更多的时间）。

基于上述情况，需要从业务需求中计算出可以用于报表打印的时间，然后从这个时间计算出最大打印页面数。如果超过这个页面数，系统会报错。或者，可以选择将输出分散到多台打印机上，确保在预期的时间内完成，这种策略也应该被明确描述



###### 4.打印机控制 

如前所述的“页面数控制”，也会受到打印机性能和打印机数量的影响。如果能够控制打印机，那么对应的策略也会有所不同。换句话说，根据打印机的数量，帳票处理的性能会进行扩展。

此外，可能需要在夜间自动打印或根据业务上的使用单位（如负责人、客户、地区等）进行打印分类。虽然帳票处理中可能实现了一些这样的功能，但在某些情况下，还必须通过spool控制来进行打印。在这种情况下，由于受到作为帳票基础的spool中间件的控制，因此处理方式也会受到影响。



###### 5.基本格式

对于帳票（报表），与屏幕相同，有时采用相似的格式进行打印会更容易理解。因此，设计基本的格式可以使帳票设计流程更加顺利。

###### i）标题部分：

作为帳票的标题部分，需要整理并确定内容，如公司标志、标题、打印者、负责人、输出日期、目标日期（业务日期）和数据抽取条件，并加以描述。由于这些内容取决于业务，所以标题部分本身可能就是打印的主要内容。

###### ii）脚注部分： 

作为脚注，需要整理并确定如著作权声明和公司名称等内容，并加以描述。

###### iii）打印纸张：

在某些情况下，需要为打印准备已经印有固定格式的纸张。这种纸张在输出的帳票中有特定意义时会被使用（例如生命保险的设计书就是这样的例子）。 在这种情况下，确定哪些帳票将使用打印纸张以及具体的打印内容是帳票设计的一部分。在帳票共通中，可以制作这种打印用纸张的列表，以便在帳票设计时参考。



###### 6.错误处理策略

###### i）Spool错误： 

考虑到无法将数据发送到spool或从spool发送数据到打印机的情况，需要审查并描述错误处理策略。当从spool的控制驱动程序或中间件上升出现错误时，也可能需要从架构上设计它。

ii）打印机错误：

 打印机可能经常处于无法输出的状态。例如，电源未打开、打印机故障、无法连接到网络、纸张卡住或墨粉用完。需要决定是在打印前确定这些状态，还是在发送后发生错误时确定，并可能需要停止发送数据，这也包括决定错误处理策略。

打印机的输出语言通常依赖于“页面”这一概念。如果在中途停止发送，可能会打印出大量无意义的字符串（页面语言本身），或打印机的缓冲区可能会溢出。因此，在发送一页数据后，可能需要停止打印机等处理。



###### 7.重复打印

在业务上需要重新打印时，应描述如何进行打印。特别是对于跨年度或跨月份的过去的打印，由于它会影响数据历史的保持方式，所以需要进行确认，并结合数据库的共同规定和架构的处理方法进行描述。



###### 8.可用的表达形式

在报表中可以考虑的表示方式包括文字、表格、图形（如标志）、条形码（如JAN、CODE128）、QR码、图表等多种形式。但它也依赖于报表基础的表达形式。因此，基于选择的基础进行描述。



